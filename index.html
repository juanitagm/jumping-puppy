<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Jumping Puppy Runner</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --pink:#ff5fb0;
      --pink-dark:#e44e9b;
      --blue:#7bd0ff; /* clear blue */
      --blue-deep:#4aa9ff;
      --yellow:#ffd166;
      --green:#35d0a0;
      --lav:#caa9ff;
      --ink:#1a1640;
      --bg:#eaf7ff;
    }
    html,body{height:100%;}
    body{
      margin:0;
      font-family:"Baloo 2", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color:var(--ink);
      background: linear-gradient(180deg, var(--blue) 0%, var(--bg) 65%);
      overflow:hidden;
      display:flex; align-items:center; justify-content:center;
    }
    .game-shell{
      position:relative; width:min(100vw, 900px); aspect-ratio:16/9; 
      box-shadow:0 20px 50px rgba(26,22,64,.25);
      border-radius:28px; overflow:hidden; background:transparent;
      border:3px solid rgba(255,255,255,.5);
    }
    canvas{ display:block; width:100%; height:100%; background:transparent; }

    /* HUD */
    .hud{ position:absolute; inset:0; pointer-events:none; }
    .score{
      position:absolute; top:10px; left:14px; pointer-events:none;
      font-weight:700; font-size:22px; letter-spacing:.5px;
      color:#0d2060; text-shadow:0 2px 0 rgba(255,255,255,.8);
    }
    .score .hi{ font-weight:400; opacity:.8; }
    .btnbar{ position:absolute; top:8px; right:10px; display:flex; gap:8px; }
    .btn{
      pointer-events:auto;
      border:none; border-radius:999px; padding:8px 14px; font-weight:700; cursor:pointer;
      background:linear-gradient(180deg, var(--pink) 0%, var(--pink-dark) 100%);
      color:white; box-shadow:0 6px 0 rgba(0,0,0,.15);
      transition: transform .05s ease, box-shadow .05s ease, filter .2s ease;
      user-select:none;
    }
    .btn:active{ transform:translateY(2px); box-shadow:0 4px 0 rgba(0,0,0,.15); }
    .btn.ghost{ background: white; color: var(--ink); box-shadow:0 6px 0 rgba(0,0,0,.08); }
    .btn.small{ padding:6px 10px; font-size:14px; }

    /* Overlay panels */
    .overlay{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; }
    /* Ensure hidden overlays are truly hidden */
    .overlay[hidden]{ display:none !important; }

    .panel{
      pointer-events:auto;
      background:rgba(255,255,255,.85);
      backdrop-filter: blur(6px);
      border:3px solid white; border-radius:24px; padding:24px 24px 20px; text-align:center;
      box-shadow:0 16px 50px rgba(0,0,0,.15);
      max-width:min(88%, 560px);
      color:#102058;
      animation: pop .25s ease-out;
    }
    @keyframes pop{ from{ transform:scale(.98); opacity:0;} to{ transform:scale(1); opacity:1;} }
    .title{ font-size:40px; margin:0 0 4px; letter-spacing:.5px; color:#102058; }
    .subtitle{ margin:0; opacity:.85; }
    .panel .row{ margin-top:16px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
    .pill{
      display:inline-flex; align-items:center; gap:6px; padding:6px 12px; border-radius:999px;
      background: linear-gradient(180deg, var(--blue) 0%, var(--blue-deep) 100%);
      color:white; font-weight:700; box-shadow:0 6px 0 rgba(0,0,0,.1);
    }

    /* Mobile hint */
    .hint{ font-size:14px; opacity:.8; margin-top:8px; }

    /* Accessibility focus styles */
    .btn:focus-visible{ outline:3px solid var(--yellow); outline-offset:2px; }
  </style>
</head>
<body>
  <div class="game-shell" role="application" aria-label="Jumping Puppy Runner game">
    <canvas id="game" aria-hidden="true"></canvas>

    <div class="hud" aria-live="polite">
      <div class="score">Score: <span id="score">0</span> ¬∑ <span class="hi">Best: <span id="hiscore">0</span></span></div>
      <div class="btnbar">
        <button id="muteBtn" class="btn ghost small" aria-pressed="false" title="Toggle sound (M)">üîä Sound</button>
        <button id="pauseBtn" class="btn ghost small" aria-pressed="false" title="Pause (P)">‚è∏ Pause</button>
        <button id="retryBtn" class="btn small" title="Retry (R)">‚Üª Retry</button>
      </div>
    </div>

    <div id="startOverlay" class="overlay">
      <div class="panel">
        <h1 class="title">üê∂ Jumping Puppy Runner</h1>
        <p class="subtitle">Jump over obstacles, survive, and make your kawaii puppy proud.</p>
        <div class="row">
          <span class="pill">‚¨ÜÔ∏è Press Space / Tap to Jump</span>
          <span class="pill">üöÄ Speed increases over time</span>
          <span class="pill">üèÜ High score saved</span>
          <span class="pill">ü§£ Silly sounds included</span>
        </div>
        <div class="row">
          <button id="playBtn" class="btn" autofocus>‚ñ∂Ô∏è Start</button>
          <button id="howBtn" class="btn ghost">‚ùì How to Play</button>
        </div>
        <div class="hint">Tip: press <b>M</b> to mute, <b>P</b> to pause.</div>
      </div>
    </div>

    <div id="howOverlay" class="overlay" hidden>
      <div class="panel">
        <h2 class="title" style="font-size:32px">How to Play</h2>
        <p>Press <b>Space</b> (or tap/click) to jump. Avoid bonking into obstacles. The longer you last, the faster it gets. 
        Rack up points and beat your best!</p>
        <ul style="text-align:left; margin:8px auto 0; max-width:420px; line-height:1.4">
          <li><b>Jump:</b> Space / W / ‚Üë / Tap</li>
          <li><b>Retry:</b> R or the ‚Üª button</li>
          <li><b>Pause:</b> P</li>
          <li><b>Sound:</b> M to toggle</li>
        </ul>
        <div class="row">
          <button id="backBtn" class="btn">üëç Got it</button>
        </div>
      </div>
    </div>

    <div id="gameOverOverlay" class="overlay" hidden>
      <div class="panel">
        <h2 class="title" style="font-size:36px">üí• Bonk! Game Over</h2>
        <p style="margin:.2rem 0 1rem">Score: <b id="finalScore">0</b> ¬∑ Best: <b id="finalBest">0</b></p>
        <div class="row">
          <button id="againBtn" class="btn">‚Üª Try Again</button>
          <button id="shareBtn" class="btn ghost">üì£ Share Score</button>
        </div>
        <div class="hint" id="quip">The cone of shame is temporary. Greatness is forever.</div>
      </div>
    </div>
  </div>

  <script>
  (function(){
    // IMAGE PATH (make sure the PNG is in the repo root)
    const PUPPY_SRC = "./puppy.png"; // <-- your uploaded sprite

    // --- Utilities ---------------------------------------------------------
    const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
    const rand=(a,b)=>Math.random()*(b-a)+a;
    const lerp=(a,b,t)=>a+(b-a)*t;

    // --- Canvas setup ------------------------------------------------------
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    function resize(){
      const rect = canvas.parentElement.getBoundingClientRect();
      canvas.width = Math.floor(rect.width * DPR);
      canvas.height = Math.floor(rect.height * DPR);
    }
    window.addEventListener('resize', resize, {passive:true});
    resize();

    // --- Game state --------------------------------------------------------
    let running=false, paused=false;
    let time=0, last=0, dt=0;
    let speed=220*DPR;   // start speed
    let accel=5*DPR;     // ramp-up
    let score=0, hi=Number(localStorage.getItem('jumpingPuppyHighScore')||0);
    let obstacles=[]; let confetti=[];

    // Ground level
    function groundY(){ return canvas.height*0.82; }

    // --- Input + jump buffering -------------------------------------------
    let jumpQueued=false; let bufferTimer=0; let coyoteTimer=0;
    const BUFFER_TIME=0.12, COYOTE_TIME=0.1;
    function queueJump(){ jumpQueued=true; bufferTimer=BUFFER_TIME; }
    window.addEventListener('keydown', (e)=>{
      if(['Space','KeyW','ArrowUp'].includes(e.code)) { e.preventDefault(); queueJump(); }
      else if(e.code==='KeyR'){ restart(); }
      else if(e.code==='KeyP'){ togglePause(); }
      else if(e.code==='KeyM'){ toggleMute(); }
    });
    canvas.addEventListener('pointerdown', ()=>queueJump());

    // --- Audio -------------------------------------------------------------
    let audioCtx=null; let mute=false;
    function ensureAudio(){ if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)(); }
    function beep({type='sine', freq=440, dur=.12, vol=.2, slide=0}){
      if(mute) return; ensureAudio();
      const t = audioCtx.currentTime; const o = audioCtx.createOscillator();
      const g = audioCtx.createGain(); g.gain.value=0; g.connect(audioCtx.destination);
      o.type=type; o.connect(g); o.frequency.value=freq;
      const attack=0.01, release=0.05; const end=t+dur+release;
      g.gain.linearRampToValueAtTime(vol, t+attack);
      g.gain.exponentialRampToValueAtTime(0.0001, end);
      if(slide!==0){ o.frequency.linearRampToValueAtTime(freq+slide, t+dur); }
      o.start(t); o.stop(end);
    }
    const sfx={ jump(){ beep({type:'square', freq:520, dur:.1, vol:.25, slide:140}); }, land(){ beep({type:'triangle', freq:320, dur:.07, vol:.18}); }, score(){ beep({type:'sine', freq:760, dur:.06, vol:.22}); setTimeout(()=>beep({type:'sine', freq:920, dur:.06, vol:.22}), 70); }, bonk(){ beep({type:'sawtooth', freq:280, dur:.18, vol:.28, slide:-220}); }, bark(){ beep({type:'square', freq:420, dur:.08, vol:.24}); setTimeout(()=>beep({type:'square', freq:350, dur:.08, vol:.24}),55); } };

    // --- Puppy sprite ------------------------------------------------------
    const pupImg = new Image(); pupImg.src = PUPPY_SRC;
    const pup={ x:0, y:0, vy:0, size:90*DPR, onGround:false, rotate:0 };
    function resetPuppy(){
      pup.x = canvas.width*0.22; pup.y = groundY()-pup.size*0.25; pup.vy=0; pup.onGround=true; pup.rotate=0;
      bufferTimer=0; coyoteTimer=COYOTE_TIME;
    }
    function tryJump(){
      if((pup.onGround || coyoteTimer>0) && bufferTimer>0){
        pup.onGround=false; pup.vy = -620*DPR; sfx.jump();
        bufferTimer=0; coyoteTimer=0;
      }
    }
    function drawPuppy(){
      const g=groundY();
      const x=pup.x, y=pup.y;
      const w=pup.size, h=pup.size*0.82;
      // shadow
      const shAlpha = clamp(1-((g-y)/200), 0, .35);
      ctx.save(); ctx.globalAlpha=shAlpha; ctx.fillStyle='rgba(0,0,0,.25)';
      ctx.beginPath(); ctx.ellipse(x, y+h*0.45, w*0.45, h*0.16, 0, 0, Math.PI*2); ctx.fill(); ctx.restore();
      // sprite
      ctx.save(); ctx.translate(x, y); ctx.rotate(pup.rotate);
      if(pupImg.complete) ctx.drawImage(pupImg, -w*0.5, -h*0.6, w, h);
      ctx.restore();
    }

    // --- Obstacles ---------------------------------------------------------
    function spawnObstacle(){
      const h = rand(28, 52)*DPR; const w = rand(20, 34)*DPR; const y = groundY()-h; const face=Math.random()<.7;
      obstacles.push({x:canvas.width+w, y, w, h, passed:false, face});
    }
    function drawObstacle(o){
      ctx.save();
      const grd = ctx.createLinearGradient(0, o.y, 0, o.y+o.h);
      grd.addColorStop(0, '#ff9fd1'); grd.addColorStop(1, '#ff62b5');
      ctx.fillStyle=grd; ctx.strokeStyle='#db2f88'; ctx.lineWidth=3*DPR;
      roundRect(o.x, o.y, o.w, o.h, 10*DPR); ctx.fill(); ctx.stroke();
      if(o.face){ ctx.fillStyle='#2a2850'; ctx.beginPath(); ctx.arc(o.x+o.w*0.3, o.y+o.h*0.3, 3.5*DPR,0,Math.PI*2); ctx.fill(); ctx.beginPath(); ctx.arc(o.x+o.w*0.7, o.y+o.h*0.33, 3.5*DPR,0,Math.PI*2); ctx.fill(); ctx.strokeStyle='#2a2850'; ctx.lineWidth=2*DPR; ctx.beginPath(); ctx.arc(o.x+o.w*0.5, o.y+o.h*0.55, 8*DPR, 0, Math.PI); ctx.stroke(); }
      ctx.restore();
    }

    // --- Background --------------------------------------------------------
    let bgOffset=0, hillOffset=0, tileOffset=0;
    function drawBackground(dt){
      const W=canvas.width, H=canvas.height;
      bgOffset = (bgOffset + dt*speed*0.18) % W;
      ctx.save(); ctx.globalAlpha=0.9; for(let i=0;i<3;i++) drawCloud( W - ((bgOffset + i*W/3)%W), H*0.2 + i*12*DPR, 100*DPR + i*40*DPR ); ctx.restore();
      hillOffset = (hillOffset + dt*speed*0.3) % W; ctx.fillStyle='#e6dcff'; for(let i=-1;i<3;i++) drawHill(-hillOffset + i*W*0.9, H*0.75, W*0.9, 80*DPR);
      const gy = groundY(); ctx.fillStyle='#b4f1e0'; ctx.fillRect(0, gy, W, H-gy);
      tileOffset = (tileOffset + dt*speed) % (44*DPR); ctx.strokeStyle='rgba(0,0,0,.06)'; ctx.lineWidth=2*DPR; for(let x=-tileOffset; x<W; x+=44*DPR){ ctx.beginPath(); ctx.moveTo(x, gy); ctx.lineTo(x, H); ctx.stroke(); } ctx.beginPath(); ctx.moveTo(0, gy); ctx.lineTo(W, gy); ctx.stroke();
    }
    function drawCloud(x,y,r){ ctx.fillStyle='rgba(255,255,255,.9)'; ctx.beginPath(); ctx.arc(x,y,r*0.6,0,Math.PI*2); ctx.arc(x+r*0.4,y+5*DPR,r*0.45,0,Math.PI*2); ctx.arc(x-r*0.4,y+8*DPR,r*0.5,0,Math.PI*2); ctx.fill(); }
    function drawHill(x,base,w,h){ ctx.beginPath(); ctx.moveTo(x,base); ctx.quadraticCurveTo(x+w*0.5, base-h, x+w, base); ctx.lineTo(x+w, base+h); ctx.lineTo(x, base+h); ctx.closePath(); ctx.fill(); }

    // --- Confetti ----------------------------------------------------------
    function spawnConfetti(){ for(let i=0;i<90;i++) confetti.push({x:canvas.width/2, y:canvas.height*0.25, vx:rand(-220,220), vy:rand(-350,-120), r:rand(2,4), c:["#ff8bc8","#8be7ff","#ffd166","#a7ffcb"][Math.floor(rand(0,4))], life:rand(1.2,1.8)}); }
    function drawConfetti(dt){ for(let i=confetti.length-1;i>=0;i--){ const p=confetti[i]; p.vy += 600*dt; p.x+=p.vx*dt; p.y+=p.vy*dt; p.life-=dt; if(p.life<=0 || p.y>canvas.height) confetti.splice(i,1); ctx.fillStyle=p.c; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); } }

    // --- Spawning logic ----------------------------------------------------
    let spawnTimer=0; function updateSpawns(dt){ spawnTimer -= dt; const minGap = clamp(1.2 - (speed-220)/(240), 0.9, 1.4); const nextGap = lerp(1.2, 1.9, Math.random()); if(spawnTimer<=0){ spawnObstacle(); spawnTimer = Math.max(minGap, nextGap); } }

    // --- Collision ---------------------------------------------------------
    function intersects(a,b){ return !(a.x+a.w < b.x || a.x > b.x+b.w || a.y+a.h < b.y || a.y > b.y+b.h); }

    // --- Game loop ---------------------------------------------------------
    function reset(){ paused=false; time=0; last=performance.now(); dt=0; score=0; speed=220*DPR; accel=5*DPR; obstacles.length=0; confetti.length=0; spawnTimer=0.6; resetPuppy(); updateHUD(); }
    function start(){ hide(startOverlay); hide(howOverlay); hide(gameOverOverlay); running=true; sfx.bark(); animate(); }
    function restart(){ reset(); start(); }

    function animate(now=performance.now()){
      if(!running){ return; }
      dt = Math.min(.035, (now-last)/1000); last=now; if(paused){ requestAnimationFrame(animate); return; }
      time += dt; speed += accel*dt; 

      // jump helpers
      if(bufferTimer>0) bufferTimer -= dt; else jumpQueued=false; if(!pup.onGround){ if(coyoteTimer>0) coyoteTimer -= dt; }

      // physics
      const g = 1400*DPR; if(jumpQueued) { tryJump(); }
      pup.vy += g*dt; pup.y += pup.vy*dt; const gy = groundY()-pup.size*0.25; if(pup.y>gy){ if(!pup.onGround){ sfx.land(); } pup.y=gy; pup.vy=0; pup.onGround=true; coyoteTimer=COYOTE_TIME; } else { pup.onGround=false; }
      pup.rotate = clamp(pup.vy/1200, -0.18, 0.18);

      // obstacles
      updateSpawns(dt); for(let i=obstacles.length-1;i>=0;i--){ const o=obstacles[i]; o.x -= speed*dt; if(o.x+o.w<0){ obstacles.splice(i,1); continue; } if(!o.passed && o.x+o.w < pup.x-10){ o.passed=true; score++; updateHUD(); sfx.score(); } }

      // collision box relative to sprite
      const pb = { x:pup.x - pup.size*0.28, y:pup.y - pup.size*0.55, w:pup.size*0.56, h:pup.size*0.6 };
      for(const o of obstacles){ if(intersects(pb, o)){ endGame(); break; } }

      // draw
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawBackground(dt);
      for(const o of obstacles) drawObstacle(o);
      drawPuppy();
      drawConfetti(dt);

      requestAnimationFrame(animate);
    }

    function endGame(){ running=false; sfx.bonk(); const newHi=Math.max(score, hi); const beat=newHi>hi; hi=newHi; localStorage.setItem('jumpingPuppyHighScore', hi); document.getElementById('finalScore').textContent=score; document.getElementById('finalBest').textContent=hi; document.getElementById('quip').textContent = beat ? "New best! Someone gets extra treats!" : quips[Math.floor(Math.random()*quips.length)]; if(beat){ spawnConfetti(); sfx.score(); setTimeout(()=>sfx.score(),120); } show(gameOverOverlay); }

    function updateHUD(){ document.getElementById('score').textContent=score; document.getElementById('hiscore').textContent=hi; }

    // --- UI controls -------------------------------------------------------
    const startOverlay=document.getElementById('startOverlay');
    const gameOverOverlay=document.getElementById('gameOverOverlay');
    const howOverlay=document.getElementById('howOverlay');
    const playBtn=document.getElementById('playBtn');
    const howBtn=document.getElementById('howBtn');
    const backBtn=document.getElementById('backBtn');
    const againBtn=document.getElementById('againBtn');
    const shareBtn=document.getElementById('shareBtn');
    const retryBtn=document.getElementById('retryBtn');
    const pauseBtn=document.getElementById('pauseBtn');
    const muteBtn=document.getElementById('muteBtn');

    function show(el){ el.hidden=false; }
    function hide(el){ el.hidden=true; }

    playBtn.addEventListener('click', ()=>{ restart(); start(); });
    howBtn.addEventListener('click', ()=>{ hide(startOverlay); show(howOverlay); });
    backBtn.addEventListener('click', ()=>{ hide(howOverlay); show(startOverlay); });
    againBtn.addEventListener('click', ()=>{ hide(gameOverOverlay); restart(); start(); });
    shareBtn.addEventListener('click', ()=>{ const txt=`I scored ${score} in Jumping Puppy Runner! Can you beat me? üê∂üèÜ`; if(navigator.share){ navigator.share({title:'Jumping Puppy Runner', text:txt}); } else { navigator.clipboard.writeText(txt); alert('Copied to clipboard! Paste it anywhere.'); } });
    retryBtn.addEventListener('click', ()=>{ if(running){ endGame(); } hide(gameOverOverlay); restart(); start(); });

    function togglePause(){ paused=!paused; pauseBtn.setAttribute('aria-pressed', String(paused)); pauseBtn.textContent = paused? '‚ñ∂Ô∏è Resume' : '‚è∏ Pause'; }
    pauseBtn.addEventListener('click', togglePause);

    function toggleMute(){ mute=!mute; muteBtn.setAttribute('aria-pressed', String(mute)); muteBtn.textContent = mute? 'üîá Muted' : 'üîä Sound'; }
    muteBtn.addEventListener('click', toggleMute);

    const quips=[ 'Paws were a bit slippery there.', 'Obstacles 1 ¬∑ Puppy 0. Rematch?', 'Gravity is undefeated.', 'That obstacle was flirting with you.', 'Tail up. Chin up. Try again!' ];

    // Kickoff
    document.getElementById('hiscore').textContent=hi;
    reset();

    // Helpers
    function roundRect(x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); }
  })();
  </script>
</body>
</html>
